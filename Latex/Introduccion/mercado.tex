\section{Introducci\'on}

Una de las formas más sencillas, y a la vez dif\'iciles, de enriquecerse es la compra de bienes y posterior venta a un precio mayor. La ganacia se produce si se consigue que la diferencia entre el precio de compra y el precio de venta sea mayor que los costes producidos a raz\'on de esa transacci\'on. En el mundo de los negocios la compra y la venta de bienes aparecen en casi todos los sectores econ\'omicos. Por ejemplo:

\begin{itemize}
    \item Distribuci\'on de mercanc\'ias. Hay empresas que se dedican a comprar mercanc\'ias en un punto y distribuirlas por otras zonas a un precio mayor. El coste de este ejercicio reside en el transporte. La empresa debe asegurar que los costes de transporte no superan a la diferencia de precio entre compra y venta.
    
    \item Especulaci\'on de terrenos o edificios. Un poco m\'as cara que la anterior, la compra y posterior venta de edificios puede producir beneficios. Las empresas que se dedican a esto tienen en cuenta las posibles construcciones que se van a hacer por la zona que, posiblemente, elevar\'an el valor del inmueble y har\'an el negocio posible. Mantener terreno conlleva un pago de impuestos, que tendr\'a que ser cubierto con el beneficio de la venta. Pero, en este caso, los inmuebles se pueden alquilar para sacar un beneficio continuo.
\end{itemize}

Del mismo modo, el mercado de valores brinda una posibilidad para extraer beneficio con la compra y venta. Se compran acciones a un precio determinado y se intentan vender a otro m\'as alto. Esto es posible gracias al mecanismo de compra y venta de la bolsa que se va a ilustrar a continuaci\'on.

\subsection{El mercado de valores}

El mercado de valores o bolsa es un tipo de mercado en el que se compran y venden productos burs\'atiles. Para este trabajo, prestaremos principal atenci\'on a las acciones, el producto burs\'atil m\'as simple de un mercado de valores, aunque hay otros tipos de mercanc\'ia con los que tambi\'en se puede especular.\\

Una acci\'on equivale a una pequeña participaci\'on en la empresa a la que pertenece la acci\'on. De esta forma, inversores privados tienen la posibilidad de comprar porciones de empresas. Por ejemplo, si una empresa est\'a dividida en 200 acciones, tras comprar 50 de estas, ser\'iamos propietarios de una cuarta parte de la empresa. Ser part\'icipes del accionariado de una empresa puede reportarnos beneficios de distinta \'indole seg\'un las normas de la misma. En ocasiones algunas empresas deciden repartir una determinada cantidad de dinero entre sus accionistas a partir de las ganancias obtenidas en un periodo (dividendo). Otras veces, ser poseedor de una gran parte de la empresa otorgar\'a derechos dentro de la misma como, por ejemplo, participar en las decisiones importantes que se tomen.\\

Por \'ultimo, el mercado de valores espa\~nol abre de 9:00 a 17:30 de lunes a viernes. Pero cabe destacar que hay una aleatoriedad de 30 segundos, es decir, la hora exacta de la apertura y del cierre var\'ia de forma no definida hasta en 30 segundos. Además, despu\'es del cierre hay un periodo de subasta de 5 minutos, durante el cual el valor de las acciones est\'a oculto para evitar manipulaciones de los precios en los \'ultimos minutos. \\

Todas estas anotaciones sobre el funcionamiento de la bolsa son interesantes. No obstante, conocer los detalles del mercado de valores no es nuestro objetivo primordial, luego ser\'a suficiente con tener el conocimiento anteriormente explicado.\\

En su lugar, vamos a centrar la atenci\'on en estudiar los movimientos de precio que sufren las acciones. Si se tiene informaci\'on que nos d\'e certeza sobre la subida del precio de la acci\'on, entonces el negocio es seguro y ser\'a sencillo extraer beneficio. Si, por el contrario, no se dispone de informaci\'on, el valor de las acciones podr\'ia bajar y provocar una p\'erdida de dinero.\\

\subsubsection{El valor de las acciones}

El valor de una acci\'on no es fijo, sino que cambia seg\'un la oferta y la demanda de las acciones de la empresa. Esto convierte a las acciones en un producto muy conveniente para especular.\\

El mecanismo de compra y venta es el que define el valor de una acci\'on. Para comprar o vender, un inversor debe enviar a bolsa una orden de compra o venta, respectivamente. Tras enviar la orden, esta queda registrada y ser\'a ejecutada tan pronto como sea posible. Aclaremos este proceso con un ejemplo sencillo:\\

Supongamos que existe una empresa que tiene en el mercado cuatro acciones. Cada una de ellas pertenece a un propietario distinto, llamados A, B, C y D. \\

El inversor A tiene una orden de venta de su acci\'on a 4 euros y C tiene una orden de compra de una acci\'on a 1 euro. En esta situaci\'on ninguno puede vender ni comprar, y el precio queda situado en 4 euros por acci\'on. Ahora bien, el accionista B decide vender su acci\'on por 3 euros. En el momento en el que realiza una orden de venta, el precio de las acciones baja a 3 euros. Esto no quiere decir que el inversor A venda su acci\'on a este precio. Para bajar de 4 a 3 euros el precio de su acci\'on deber\'ia cancelar la orden y realizar una nueva. En esta situaci\'on no se puede ejecutar ninguna orden en el mercado, como se puede ver en la figura \ref{fig:ordenes_ejemplo}.\\

\begin{figure}[H]
	\centering
	\includegraphics[scale=2]{imagenes/ordenes_ejemplo.png}
	\caption[Ejemplo de situaci\'on de las \'ordenes]{Situaci\'on de las \'ordenes.\\ Fuente: elaboraci\'on propia.}
	\label{fig:ordenes_ejemplo}
\end{figure}


De este modo, tras conocer que el precio de la acci\'on ha bajado de 4 a 3 euros, el inversor D decide comprar y sit\'ua una orden de compra a 3 euros de una acci\'on. Entonces, la orden de venta de C y la orden de compra de D pueden ejecutarse y, por ende, anularse. Ahora el inversor D pasa a tener 2 acciones y el mercado se queda con tan solo las dos \'ordenes de A y B. A causa de este hecho, el precio de la acci\'on vuelve a subir a 4 euros, la orden de venta m\'as baja.\\

En el ejemplo anterior se han simplificado las \'ordenes de compra y venta. En realidad, las ordenes que existen son algo m\'as complejas:\\

\begin{itemize}
	
	\item \textbf{Orden de mercado.} Con este tipo de orden se compran todas las acciones que se especifiquen al mejor precio posible. En caso de que la orden sea de compra, se adquieren acciones a los precios m\'as bajos, en caso de que sea de venta, a los precios m\'as altos. Refiriendo al caso anterior, si B hubiera emitido una orden de mercado de una acci\'on, habría comprado la acci\'on del inversor A, que en este caso ten\'ia un valor de 4 euros.
	
	\item \textbf{Orden limitada.} En este caso, se compran todas las acciones que se emitan en la orden siempre y cuando su precio est\'e situado en un l\'imite establecido. Por ejemplo, si D hubiera emitido una orden limitada a 3 euros de dos acciones, hubiera comprado por 3 euros la acci\'on de C pero no hubiera adquirido la de A, que estaba situada a 4 euros. La orden limitada permanece vigente hasta que la suma total de las acciones sea comprada.
	
	\item \textbf{Orden on Stop.} En esta modalidad, la orden no se hace efectiva hasta que el precio de las acciones llega al precio estipulado en la orden. Una vez llegado ese momento, la orden se convierte en una orden de mercado, es decir, se compran o se venden todas las acciones que se especifiquen en la misma al mejor precio posible.
	
	\item \textbf{Orden Stop-Limit.} Este tipo de orden no se hace efectiva hasta que el precio de las acciones no llegue al precio de la orden. En ese momento, la orden se convierte en una orden limitada. Es muy frecuente que las plataformas ofrezcan este tipo de orden, pues funciona como seguro para no perder todo el capital cuando las acciones caen de precio r\'apidamente. Si se sospecha que las acciones pueden bajar su valor, se coloca una orden stop-limit de venta a un precio que se considere bajo. De este modo, si el valor de las acciones decae, estas se venden de forma autom\'atica. 
	
\end{itemize} 

		
		
		\subsubsection{Corredores de bolsa o brokers}
		
		Para agilizar las transacciones en bolsa, no se permite que particulares env\'ien \'ordenes al mercado. Esta tarea se delega en los corredores de bolsa o \textit{brokers}. La entidad de \textit{broker} se encarga de captar inversores, lanzar \'ordenes a bolsa y presentar a compradores con vendedores. Para ser broker se debe aprobar un examen y demostrar que se tienen los conocimientos necesarios. A cambio de realizar este trabajo se lleva una comisi\'on que todo inversor debe abonar. \\
		
		Las comisiones pueden ser de dos tipos:\\
		
		\begin{itemize}
			\item \textbf{Comisiones fijas.} Son un valor fijo que cada broker cobra. Pueden ser por transacci\'on, seg\'un cantidad de acciones y su precio, y por tiempo de servicio, seg\'un la cantidad de d\'ias que el cliente dispone para realizar transacciones. Las comisiones fijas son beneficiosas para inversores con un gran capital.
			
			\item \textbf{Comisiones variables.} Son precios variables que dependen del país de inversión, la cantidad invertida e incluso el tiempo que dura una inversi\'on. Las comisiones variables afectan en la misma medida a inversores grandes y peque\~nos. Por este motivo, un inversor con poco capital pagar\'a menos comisiones con este tipo de cobro.
		\end{itemize}
		
		La mayor\'ia de los corredores de bolsa tienen comisiones mixtas. Algunos cobran distintas comisiones seg\'un la bolsa en la que se quiera operar. \\
		
		Sirva todo lo anteriormente expuesto como introducci\'on a los mecanismos y herramientas que intervienen en el mercado de valores. Solo debemos a\~nadir que en los supuestos que trabajaremos m\'as adelante, utilizaremos una comisiones variable del 1\% de la cantidad invertida. Esto implicar\'a que por cada 100 euros invertidos, se perder\'a 1 en concepto de comisiones de \textit{broker}.\\


\subsection{La predicci\'on de bolsa}

Para obtener beneficios comprando acciones es necesario venderlas a un precio superior, que adem\'as debe soportar las comisiones. Por tanto, tener conocimiento sobre el estado del mercado sit\'ua a empresas y particulares en posiciones ventajosas a la hora de invertir. Es por esto que, siguiendo distintas estrategias, las personas que invierten en bolsa intentan extraer informaci\'on sobre la situaci\'on actual y futura del mercado.\\

A lo largo de este proyecto se va a intentar extraer informaci\'on a partir del hist\'orico de valores del mercado, es decir, vamos a utilizar el estado del mercado en un per\'iodo pasado para predecir el estado futuro. \\

El primer mercado de valores se sit\'ua en el siglo XVII. Seg\'un afirma Beattie (2017) en la revista digital Investopedia, la primera empresa en ofrecer acciones se situar\'ia en B\'elgica, promovida por la incipiente econom\'ia generada en las colonias de Asia. \\

A lo largo de tantos a\~nos de vida, los valores burs\'atiles se han intentado predecir de muchas formas. A medida que la sociedad avanza y se van creando nuevas herramientas, los modelos de predicci\'on van evolucionando y se hacen m\'as complejos.\\

En la actualidad podemos distinguir varias agrupaciones de an\'alisis de bolsa:\\

\begin{itemize}
	\item \textbf{An\'alisis fundamental}. Este tipo de an\'alisis parte de la idea central en la que el valor real de la empresa y el valor de las acciones en el mercado no coinciden. Por tanto, el precio de las acciones puede estar sobrevalorado o infravalorado y, se supone que se corregir\'a en futuro cercano. El objetivo de este tipo de an\'alisis ser\'a, en consecuencia, valorar las empresas seg\'un su condici\'on, su posici\'on empresarial, sus inversiones, los productos que desarrolla o cualquier otro factor que defina la situaci\'on econ\'omica de la empresa.
    \item \textbf{An\'alisis chartista}. Debe su nombre a la palabra inglesa \textit{chart}. Las estrategias de esta agrupaci\'on se valen de reglas gr\'aficas aplicadas sobre \'indices o sobre el propio valor de la acci\'on. Esas reglas gr\'aficas advierten de series temporales, como las ondas de Elliot (Elliot, 1994), o de tendencias y rupturas (Gartley, 1935). \\
    
    Esta estrategia se lleva utilizando mucho tiempo por su simplicidad y su f\'acil comprensi\'on y evaluaci\'on.
    Su \'exito se debe probablemente a este hecho, y es que con una sencilla herramienta gr\'afica se pueden deducir, a gran escala, algunas subidas o bajadas de los valores de bolsa.
    
    \item \textbf{An\'alisis de \'indices o indicadores}. Esta modalidad de an\'alisis se basa en el uso de estad\'isticos. En el campo de la estad\'istica, los estad\'isticos son valores que representan una determinada caracter\'istica de la variable a la que refieren. En el caso de los indicadores, informan del estado de uno o varios valores distintos de la bolsa. Una de las publicaciones con m\'as renombre es la teor\'ia de Dow\footnote{Hamilton, W. P. (1922). \textit{The Stock Market Barometer; a Study of Its Forecast Value Based on Charles H. Dow's Theory of the Price Movement}, Harper \& Bros., Nueva York}, cuyo autor, Charles H. Dow, fue el fundador del \textit{Wall Street Journal}, diario en el que publicaba sus principios para invertir en bolsa. \\
    
    Seg\'un la variable que resume el indicador podemos hablar de varios tipos. El primer tipo son los indicadores que representan la situaci\'on general de la bolsa de un pa\'is, por ejemplo el IBEX35 (35 empresas con m\'as capital de Espa\~na). Otro grupo de indicadores son los que representan la situaci\'on de las empresas que se dedican a un sector particular, como el  SX7E (bancos de los pa\'ises europeos).
    Por \'ultimo, hay indicadores que aportan informaci\'on estad\'istica sobre un solo valor, por ejemplo la EMA (Media M\'ovil Exponencial).
\end{itemize}

Este proyecto se centra en el an\'alisis de indicadores de un solo valor. En concreto, como se ver\'a a lo largo del trabajo, se propone un modelo basado en \'arboles de decisi\'on construidos a partir de un algoritmo gen\'etico. Los \'arboles de decisi\'on son, a grandes rasgos, estructuras que permiten crear una jerarqu\'ia de condiciones que tienen como conclusi\'on de las mismas una clasificaci\'on. En el caso que nos compete, la clasificaci\'on corresponder\'a a decidir si es un buen momento para comprar, para vender o es mejor esperar. En el apartado \ref{sec:algorithm} se entrar\'a con m\'as profundidad en este modelo. \\



\subsection{Tipos de informaci\'on extra\'ible a partir de \'arboles}
Podemos encontrar en la bibliograf\'ia varios modelos basados en \'arboles que, seg\'un la informaci\'on que persiguen conseguir, se pueden dividir en varios grupos. En este punto debemos hacer notar que existen otras formas y herramientas de extracci\'on de informaci\'on o predicci\'on, pero por la naturaleza de nuestra propuesta nos centraremos en las estrategias basadas en \'arboles. Debido al caracter motivacional de la secci\'on, no se entra en profundidad en estos conceptos. No obstante, la definici\'on de \'arbol puede verse posteriormente en el apartado \ref{sec:Decision_tree}.

    \subsubsection{Informaci\'on total}
    
    El m\'as ambicioso de los objetivos de un an\'alisis de bolsa es el de encontrar una forma de predecir el valor exacto de un valor burs\'atil en un instante de tiempo futuro. Encontramos entonces una funci\'on $f:\Omega \rightarrow \mathbb{R}^+$ donde $\Omega$ es un conjunto de indicadores del valor a predecir en un instante pasado o presente y la imagen, contenida en $\mathbb{R}^+$, es el valor predicho para un instante en el futuro.\\
    
    El instante predicho cambia seg\'un el autor del estudio (pueden ser horas, d\'ias o semanas), normalmente, cuanto m\'as alejado est\'a el instante en el que se eval\'ua $f$ del instante que se pretende predecir, mayor es el error.\\
    
    La funci\'on $f$ se puede representar como un \'arbol en el que en los nodos se sit\'uan operaciones (usualmente unarias o binarias) y las hojas contienen par\'ametros de la funci\'on $f$ o valores constantes. La funci\'on se eval\'ua desde las hojas hasta el nodo ra\'iz. \\
   
       
    En la figura \ref{fig:inf_compl} puede verse un \'arbol de este tipo. De este se puede extraer la funci\'on \\
    $f($OPEN, CLOSE, EMA$) = (sin($OPEN$)$ AND EMA$) * ($CLOSE/OPEN$)$\\ que, dados unos valores para la apertura, el cierre y la media m\'ovil exponencial, nos devuelve el valor en el instante futuro.\\
    
	\begin{figure}[H]
		\centering
    	\includegraphics[scale=0.47]{imagenes/arbol_inf_comp.png}
    	\caption[Ejemplo de \'arbol de programaci\'on gen\'etica]{Ejemplo de \'arbol de programaci\'on gen\'etica.\\ Fuente: elaboraci\'on propia.}
    	\label{fig:inf_compl}
    \end{figure}

    
    Para ajustar los \'arboles se usa un algoritmo gen\'etico con funci\'on \textit{fitness} el error medio cuadr\'atico entre el valor predicho y el error real (Sheta, 2013). Se comentar\'a con profundidad el funcionamiento de los algoritmos gen\'eticos m\'as adelante. Tambi\'en existe otra variante basada en el \textit{Conditional Sharpe Ratio} aplicada en Esfahanipour (2011) y Mousavi (2014).\\
    
    Por \'ultimo, una funci\'on \textit{fitness} algo diferente es puntuar cada estrategia a partir del beneficio simulado obtenido en un periodo de tiempo (Potvin, 2004).\\
    
     Si se consiguiese hallar una funci\'on $f$ con un error nulo, obtendr\'iamos una informaci\'on perfecta con la que podr\'iamos conseguir el m\'aximo beneficio en bolsa. No obstante, este tipo de modelos es demasiado ambicioso. Computacionalmente es pesado y la funci\'on resultante no es, en casi todos los casos, interpretable.\\
     
     
     \subsubsection{Informaci\'on de tendencias}
     
     En lugar de buscar una predicci\'on exacta del valor en el futuro, podemos estar interesados en obtener informaci\'on sobre la tendencia de un valor, es decir, si est\'a en un periodo ascendente o descendente. \\
     
     Este m\'etodo puede ser visto como una relajaci\'on del m\'etodo desarrollado en el apartado anterior. Aunque el paso de una imagen continua ($\mathbb{R}$) a una imagen discreta (sube, baja, se queda igual) nos obliga a realizar otro tipo de \'arboles. En este caso se suele proponer un \'arbol de decisi\'on con tres etiquetas. Pero no vamos a entrar en detalle aqu\'i en esta herramienta, ya que ser\'a explicada en profundidad en el apartado \ref{sec:Decision_tree}.\\
     
     Estos modelos de informaci\'on son bastante m\'as sencillos de interpretar. Pero, por contra, son bastante m\'as imprecisos. El modelo nos dice la tendencia que tendr\'a el valor. Sin embargo, seg\'un los objetivos de inversi\'on, las comisiones u otras situaciones econ\'omicas, esta informaci\'on podr\'ia no ser suficiente para sacar beneficios.\\
     
     Para profundizar en la extracci\'on de este tipo de informaci\'on se sugiere ver Nair (2010) o Huang (2008).\\
     
     
     \subsubsection{Informaci\'on de se\~nales de compra y venta}
     
     A medio camino entre los dos tipos de informaci\'on anteriores tenemos los modelos de señales, mediante los cuales, lo m\'as importante no es conocer el valor de la acci\'on, si sube o si baja, sino buscar un modelo que nos diga cuando comprar y cuando vender. A estas advertencias de los modelos de compra y venta se le llaman se\~nales de compra y venta. Cabe decir que se puede hacer una extensi\'on del modelo para que no tenga una decisi\'on binaria, por ejemplo un modelo de cuatro etiquetas: compra discreta, venta discreta, compra masiva y venta masiva. \\
     
     De este tipo de extracci\'on de informaci\'on hay menos ejemplos, que suelen estar ejecutados a partir de varios \'arboles de salida booleana, cada uno de ellos asociado a una se\~nal. En Myszkowski (2010) podemos ver un claro ejemplo con dos \'arboles, uno que indica la compra y otro que indica la venta.\\
     
     	\begin{figure}[H]
			\centering\leftskip=-10px
			\includegraphics[scale=0.77]{imagenes/tree_halfinfo.png}
			\caption[Ejemplo de \'arbol de señales de compra]{Ejemplo de \'arbol de señales de compra. \\Fuente: Myszkowski (2010)}
			\label{fig:tree_half_info}
		\end{figure}
		
	En la figura \ref{fig:tree_half_info} se muestra un \'arbol de se\~nal de compra. N\'otese que en los nodos hoja siempre hay una condici\'on booleana que puede contener un solo indicador o, en caso especial, dos.\\
	
	\subsection{Objetivo del proyecto}
	La importancia de obtener informaci\'on exclusiva sobre el estado de la bolsa es evidente, ya que esto te permite invertir en bolsa con mayor posibilidad de sacar beneficios que si se realizara por mera intuici\'on.\\
	
	De este modo, siguiendo el desarrollo realizado en los antecedentes aportados, se propone conseguir los siguientes objetivos principales:
	
	\begin{itemize}
	    \item Realizar un estudio de los valores de bolsa a partir de t\'ecnicas avanzadas de aprendizaje autom\'atico: \'arboles de decisi\'on y algoritmos gen\'eticos. En concreto, y siguiendo la l\'inea anteriormente explicada, se intentar\'an inducir modelos basados se\~nales de compra y venta.
	    \item Simular con los modelos aprendidos en distintas tendencias burs\'atiles y comparar los resultados con los aportados en la bibliograf\'ia.
	\end{itemize}
	
	A pesar de que el hist\'orico de datos es clave para predecir los valores futuros, el mercado de valores a menudo se ve influenciado por otros factores no predecibles (noticias, pol\'itica, guerras o cat\'astrofes ambientales, por ejemplo). Por tanto, aunque el modelo predicho sea muy bueno, siempre habr\'a un punto de incertidumbre que nunca estaremos en condiciones de analizar.\\
	
	
	